<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>62 OtobÃ¼s Saatleri</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --primary: #2563eb;
      --muted: #6b7280;
      --border: #e5e7eb;
      --accent: #22c55e;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, #e0ecff 0, transparent 30%), radial-gradient(circle at 80% 0%, #ffe0f0 0, transparent 30%), var(--bg);
      color: #0f172a;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .app {
      width: min(520px, 100%);
      background: var(--card);
      border-radius: 28px;
      box-shadow: 0 24px 70px rgba(15, 23, 42, 0.1);
      padding: 22px 22px 18px;
      border: 1px solid var(--border);
    }
    .hero {
      background: linear-gradient(135deg, #2563eb, #9333ea);
      color: #fff;
      border-radius: 22px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 14px;
      box-shadow: 0 18px 40px rgba(79, 70, 229, 0.35);
      margin-bottom: 16px;
    }
    .hero-icon {
      width: 64px;
      height: 64px;
      border-radius: 18px;
      background: rgba(255,255,255,0.18);
      display: grid;
      place-items: center;
      font-size: 34px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.2);
    }
    .hero-text h1 {
      margin: 0;
      font-size: 22px;
      line-height: 1.25;
    }
    .hero-text .subtitle {
      margin: 4px 0 0;
      color: rgba(255,255,255,0.8);
      font-size: 14px;
    }
    .hero-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.16);
      color: #fff;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 13px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .refresh-btn {
      border: none;
      background: #fff;
      color: #1d4ed8;
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
    }
    .refresh-btn:hover { transform: translateY(-1px); }
    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .item {
      padding: 14px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 12px 36px rgba(15, 23, 42, 0.06);
    }
    .item-main { display: flex; flex-direction: column; gap: 6px; }
    .time {
      font-size: 19px;
      font-weight: 800;
      letter-spacing: 0.2px;
      color: #0f172a;
    }
    .note { color: var(--muted); font-size: 13px; }
    .badge {
      min-width: 96px;
      text-align: center;
      padding: 10px 12px;
      border-radius: 12px;
      background: #ecfdf3;
      color: #166534;
      font-weight: 800;
      box-shadow: inset 0 0 0 1px #bbf7d0;
    }
    .empty {
      text-align: center;
      color: var(--muted);
      padding: 16px;
      border-radius: 12px;
      border: 1px dashed var(--border);
      background: #f8fafc;
    }
    footer {
      margin-top: 14px;
      text-align: center;
      font-size: 12px;
      color: var(--muted);
    }
    a { color: var(--primary); text-decoration: none; }
  </style>
</head>
<body>
  <div class="app">
    <div class="hero">
      <div class="hero-icon">ðŸšŒ</div>
      <div class="hero-text">
        <h1>62 OtobÃ¼s Saatleri</h1>
        <div class="subtitle">KaÄŸÄ±thane â†’ KabataÅŸ</div>
        <div class="hero-meta">
          <span class="pill" id="day-label">YÃ¼kleniyorâ€¦</span>
          <span class="pill" id="now-label">Åžu an:</span>
          <button class="refresh-btn" id="refresh-btn">Yenile</button>
        </div>
      </div>
    </div>

    <div class="list" id="next-list"></div>

    <footer>
      Veriler <a href="https://iett.istanbul/RouteDetail?hkod=62&routename=%20KA%C4%9EITHANE%20%20-%20%20KABATA%C5%9E%20" target="_blank">Ä°ETT</a> kaynaÄŸÄ±ndan alÄ±nmÄ±ÅŸtÄ±r.
    </footer>
  </div>

  <script>
    const scheduleUrl = './schedule.json';

    const getNowIstanbul = () => {
      const now = new Date();
      const ist = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/Istanbul' }));
      return ist;
    };

    const timeToMinutes = (hhmm) => {
      const [h, m] = hhmm.split(':').map(Number);
      return h * 60 + m;
    };

    const formatDiff = (minutes) => {
      if (minutes <= 0) return 'KalkÄ±yor';
      if (minutes < 60) return `${minutes} dk`;
      const h = Math.floor(minutes / 60);
      const m = minutes % 60;
      if (m === 0) return `${h} sa`;
      return `${h} sa ${m} dk`;
    };

    const pickDayKey = (date) => {
      const day = date.getDay(); // 0 pazar
      if (day === 0) return 'sunday';
      if (day === 6) return 'saturday';
      return 'weekday';
    };

    const render = (data) => {
      const now = getNowIstanbul();
      const nowMinutes = now.getHours() * 60 + now.getMinutes();
      const dayKey = pickDayKey(now);
      const listEl = document.getElementById('next-list');
      listEl.innerHTML = '';

      document.getElementById('now-label').textContent = `Åžu an: ${now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })}`;
      const dayNames = { weekday: 'Ä°ÅŸ GÃ¼nleri', saturday: 'Cumartesi', sunday: 'Pazar' };
      document.getElementById('day-label').textContent = dayNames[dayKey] || 'GÃ¼n';

      const todays = (data[dayKey] || [])
        .map((t) => ({ time: t, minutes: timeToMinutes(t) }))
        .sort((a, b) => a.minutes - b.minutes); // ensure chronological order

      // take unique upcoming times, max 5
      const seen = new Set();
      const upcoming = [];
      for (const t of todays) {
        if (t.minutes >= nowMinutes && !seen.has(t.minutes)) {
          seen.add(t.minutes);
          upcoming.push(t);
          if (upcoming.length === 5) break;
        }
      }

      if (upcoming.length === 0) {
        const div = document.createElement('div');
        div.className = 'empty';
        div.textContent = 'BugÃ¼n iÃ§in kalan sefer gÃ¶rÃ¼nmÃ¼yor.';
        listEl.appendChild(div);
        return;
      }

      upcoming.forEach((item, idx) => {
        const diff = item.minutes - nowMinutes;
        const card = document.createElement('div');
        card.className = 'item';

        const main = document.createElement('div');
        main.className = 'item-main';
        const time = document.createElement('div');
        time.className = 'time';
        time.textContent = `${idx + 1}. ${item.time}`;
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = 'KaÄŸÄ±thane kalkÄ±ÅŸÄ±na kalan sÃ¼re';
        main.appendChild(time);
        main.appendChild(note);

        const badge = document.createElement('div');
        badge.className = 'badge';
        badge.textContent = formatDiff(diff);

        card.appendChild(main);
        card.appendChild(badge);
        listEl.appendChild(card);
      });
    };

    const loadData = async () => {
      try {
        const res = await fetch(scheduleUrl);
        const json = await res.json();
        render(json);
      } catch (err) {
        const listEl = document.getElementById('next-list');
        listEl.innerHTML = `<div class="empty">Veri yÃ¼klenemedi. LÃ¼tfen yenileyin.</div>`;
        console.error(err);
      }
    };

    document.getElementById('refresh-btn').addEventListener('click', loadData);
    loadData();
  </script>
</body>
</html>

